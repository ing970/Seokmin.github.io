---
title:  "Groupby 관련메소드 및 일괄처리 메소드"
categories:
    - Groupy #똑같이 맞추기
tags:
    - python, groupby, pandas
toc: true
toc_sticky: true
toc_label: "목차"
---




# filter()
- `DataFrameGroupBy.filter(func, dropna=True, *args, **kwargs)`
- 특정 조건을 만족하는 Group의 데이터(행)들을 조회할 때 사용한다. 주로 조건은 group별 집계결과를 이용한다.
    1. 함수에 group별 DataFrame을 argument로 전달한다.
    2. 함수는 받은 DataFrame을 이용해 집계한 값의 조건을 비교해서 반환한다.(반환타입: Bool) 
    3. 반환값이 True인 Group들의 모든 행들로 구성된 DataFrame을 반환한다.
- 매개변수
    - **func**: filtering 조건을 구현한 함수 객체
        - 첫번째 매개변수로 Group으로 묶인 DataFrame을 받는다.
        - bool type 값을 반환한다. 매개변수로 받은 DataFrame이 특정 조건을 만족하는지 여부를 반환한다.
    - **dropna=True**
        - 필터를 통과하지 못한 group의 DataFrame의 값들을 drop시킨다(기본값). False로 설정하면 NA 처리해서 반환한다.
    - **\*args, \*\*kwargs**: filter 함수의 두번째부터  선언된 매개변수에 전달할 argument 값들을 가변인자로 전달한다.


```python
import numpy as np
import pandas as pd

# cnt1 값의 범위: 사과: 10대, 귤: 20대, 배: 단단위, 딸기 30이상
data = dict(fruits=['사과', '사과','사과', '사과','사과','귤','귤','귤','귤','귤','배','배','배','배','배','딸기','딸기','딸기','딸기','딸기']
            ,cnt1=[10, 12, 13, 11, 12, 21, 22, 27, 24, 26, 7, 7, 8, 3, 2, 30, 35, 37, 41, 28]
            ,cnt2=[100,  103, 107, 107,  101,  51,  57, 58,  57, 51,  9, 9,  5,  7,  7,  208, 217, 213, 206, 204]
           )
df = pd.DataFrame(data)
df
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fruits</th>
      <th>cnt1</th>
      <th>cnt2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>사과</td>
      <td>10</td>
      <td>100</td>
    </tr>
    <tr>
      <th>1</th>
      <td>사과</td>
      <td>12</td>
      <td>103</td>
    </tr>
    <tr>
      <th>2</th>
      <td>사과</td>
      <td>13</td>
      <td>107</td>
    </tr>
    <tr>
      <th>3</th>
      <td>사과</td>
      <td>11</td>
      <td>107</td>
    </tr>
    <tr>
      <th>4</th>
      <td>사과</td>
      <td>12</td>
      <td>101</td>
    </tr>
    <tr>
      <th>5</th>
      <td>귤</td>
      <td>21</td>
      <td>51</td>
    </tr>
    <tr>
      <th>6</th>
      <td>귤</td>
      <td>22</td>
      <td>57</td>
    </tr>
    <tr>
      <th>7</th>
      <td>귤</td>
      <td>27</td>
      <td>58</td>
    </tr>
    <tr>
      <th>8</th>
      <td>귤</td>
      <td>24</td>
      <td>57</td>
    </tr>
    <tr>
      <th>9</th>
      <td>귤</td>
      <td>26</td>
      <td>51</td>
    </tr>
    <tr>
      <th>10</th>
      <td>배</td>
      <td>7</td>
      <td>9</td>
    </tr>
    <tr>
      <th>11</th>
      <td>배</td>
      <td>7</td>
      <td>9</td>
    </tr>
    <tr>
      <th>12</th>
      <td>배</td>
      <td>8</td>
      <td>5</td>
    </tr>
    <tr>
      <th>13</th>
      <td>배</td>
      <td>3</td>
      <td>7</td>
    </tr>
    <tr>
      <th>14</th>
      <td>배</td>
      <td>2</td>
      <td>7</td>
    </tr>
    <tr>
      <th>15</th>
      <td>딸기</td>
      <td>30</td>
      <td>208</td>
    </tr>
    <tr>
      <th>16</th>
      <td>딸기</td>
      <td>35</td>
      <td>217</td>
    </tr>
    <tr>
      <th>17</th>
      <td>딸기</td>
      <td>37</td>
      <td>213</td>
    </tr>
    <tr>
      <th>18</th>
      <td>딸기</td>
      <td>41</td>
      <td>206</td>
    </tr>
    <tr>
      <th>19</th>
      <td>딸기</td>
      <td>28</td>
      <td>204</td>
    </tr>
  </tbody>
</table>
</div>



- filter 함수 - cnt1의 평균이 20 이상인 과일 데이터들을 조회한다.


```python
result = df.groupby('fruits')['cnt1'].mean()
result2= result[result >= 20]
result.index
df[df['fruits'].isin(result2.index)]
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fruits</th>
      <th>cnt1</th>
      <th>cnt2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>5</th>
      <td>귤</td>
      <td>21</td>
      <td>51</td>
    </tr>
    <tr>
      <th>6</th>
      <td>귤</td>
      <td>22</td>
      <td>57</td>
    </tr>
    <tr>
      <th>7</th>
      <td>귤</td>
      <td>27</td>
      <td>58</td>
    </tr>
    <tr>
      <th>8</th>
      <td>귤</td>
      <td>24</td>
      <td>57</td>
    </tr>
    <tr>
      <th>9</th>
      <td>귤</td>
      <td>26</td>
      <td>51</td>
    </tr>
    <tr>
      <th>15</th>
      <td>딸기</td>
      <td>30</td>
      <td>208</td>
    </tr>
    <tr>
      <th>16</th>
      <td>딸기</td>
      <td>35</td>
      <td>217</td>
    </tr>
    <tr>
      <th>17</th>
      <td>딸기</td>
      <td>37</td>
      <td>213</td>
    </tr>
    <tr>
      <th>18</th>
      <td>딸기</td>
      <td>41</td>
      <td>206</td>
    </tr>
    <tr>
      <th>19</th>
      <td>딸기</td>
      <td>28</td>
      <td>204</td>
    </tr>
  </tbody>
</table>
</div>




```python
def check_mean(df):
    """
    df - DataFrame. filter 에 사용하면 Group별 DataFrame이 넘어온다.
    """
    return df['cnt1'].mean() >= 20
```


```python
df.groupby('fruits').filter(check_mean)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fruits</th>
      <th>cnt1</th>
      <th>cnt2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>5</th>
      <td>귤</td>
      <td>21</td>
      <td>51</td>
    </tr>
    <tr>
      <th>6</th>
      <td>귤</td>
      <td>22</td>
      <td>57</td>
    </tr>
    <tr>
      <th>7</th>
      <td>귤</td>
      <td>27</td>
      <td>58</td>
    </tr>
    <tr>
      <th>8</th>
      <td>귤</td>
      <td>24</td>
      <td>57</td>
    </tr>
    <tr>
      <th>9</th>
      <td>귤</td>
      <td>26</td>
      <td>51</td>
    </tr>
    <tr>
      <th>15</th>
      <td>딸기</td>
      <td>30</td>
      <td>208</td>
    </tr>
    <tr>
      <th>16</th>
      <td>딸기</td>
      <td>35</td>
      <td>217</td>
    </tr>
    <tr>
      <th>17</th>
      <td>딸기</td>
      <td>37</td>
      <td>213</td>
    </tr>
    <tr>
      <th>18</th>
      <td>딸기</td>
      <td>41</td>
      <td>206</td>
    </tr>
    <tr>
      <th>19</th>
      <td>딸기</td>
      <td>28</td>
      <td>204</td>
    </tr>
  </tbody>
</table>
</div>



- lambda 표현식 이용


```python
df.groupby('fruits').filter(lambda df : df['cnt1'].mean() > 20) 
#return 결과가 True인 group의 dataframe이 결과에 추가.
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fruits</th>
      <th>cnt1</th>
      <th>cnt2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>5</th>
      <td>귤</td>
      <td>21</td>
      <td>51</td>
    </tr>
    <tr>
      <th>6</th>
      <td>귤</td>
      <td>22</td>
      <td>57</td>
    </tr>
    <tr>
      <th>7</th>
      <td>귤</td>
      <td>27</td>
      <td>58</td>
    </tr>
    <tr>
      <th>8</th>
      <td>귤</td>
      <td>24</td>
      <td>57</td>
    </tr>
    <tr>
      <th>9</th>
      <td>귤</td>
      <td>26</td>
      <td>51</td>
    </tr>
    <tr>
      <th>15</th>
      <td>딸기</td>
      <td>30</td>
      <td>208</td>
    </tr>
    <tr>
      <th>16</th>
      <td>딸기</td>
      <td>35</td>
      <td>217</td>
    </tr>
    <tr>
      <th>17</th>
      <td>딸기</td>
      <td>37</td>
      <td>213</td>
    </tr>
    <tr>
      <th>18</th>
      <td>딸기</td>
      <td>41</td>
      <td>206</td>
    </tr>
    <tr>
      <th>19</th>
      <td>딸기</td>
      <td>28</td>
      <td>204</td>
    </tr>
  </tbody>
</table>
</div>



- Parameter가 있는 filter 처리함수.
- 컬럼명, threshold값을 parameter로 받는다.


```python
def check_mean2(df:pd.DataFrame, column_name:str, threshold:int):
    return df[column_name].mean() >= threshold
```

-  1번 parameter - group 별 DataFrame이 전달. 2번째 parameter 부터는 넘겨줘야한다.


```python
df.groupby('fruits').filter(check_mean2, column_name='cnt1', threshold= 30)
df.groupby('fruits').filter(check_mean2, column_name='cnt2', threshold= 100)
df.groupby('fruits').filter(check_mean2, dropna=False, column_name='cnt2', threshold= 100)
# 3번째는 잘 사용은 안하나 이렇게도 할 수 있다!
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fruits</th>
      <th>cnt1</th>
      <th>cnt2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>사과</td>
      <td>10.0</td>
      <td>100.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>사과</td>
      <td>12.0</td>
      <td>103.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>사과</td>
      <td>13.0</td>
      <td>107.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>사과</td>
      <td>11.0</td>
      <td>107.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>사과</td>
      <td>12.0</td>
      <td>101.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>6</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>7</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>8</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>9</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>10</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>11</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>12</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>13</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>14</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>15</th>
      <td>딸기</td>
      <td>30.0</td>
      <td>208.0</td>
    </tr>
    <tr>
      <th>16</th>
      <td>딸기</td>
      <td>35.0</td>
      <td>217.0</td>
    </tr>
    <tr>
      <th>17</th>
      <td>딸기</td>
      <td>37.0</td>
      <td>213.0</td>
    </tr>
    <tr>
      <th>18</th>
      <td>딸기</td>
      <td>41.0</td>
      <td>206.0</td>
    </tr>
    <tr>
      <th>19</th>
      <td>딸기</td>
      <td>28.0</td>
      <td>204.0</td>
    </tr>
  </tbody>
</table>
</div>



# transform
- `DataFrameGroupBy.transform(func, *args)`, `SeriesGroupBy.transform(func, *args)`
    - 함수(func)에 열의 값들을 group 별로 전달 한다. 함수는 그 값을 받아 통계량을 구해 반환한다. 반환된 통계량으로 원래 값들을 변경한 Series를 반환한다. 여러 컬럼에 대해 처리할 경우 DataFrame을 반환한다.
    - func: 함수객체
        - 매개변수
            - 그룹별 컬럼값들을 받을 변수 선언
        - return
            - 계산한 통계량.
        - DataFrameGroupBy은 모든 컬럼의 값들을 group 별 Series로 전달한다.
    - *args: 함수에 전달할 추가 인자값이 있으면 매개변수 순서에 맞게 값을 전달한다.
- transform() 함수를 groupby() 와 사용하면 컬럼의 각 원소들을 자신이 속한 그룹의 통계량으로 변환된 데이터셋을 생성할 수 있다.
- 컬럼의 값과 통계값을 비교해서 보거나 결측치 처리등에 사용할 수있다.
- 디테일하게 그룹별로 비교할때 사용한다.

## 원본에 통계치 붙여서 비교하기

- DataFrameGroupby -> group별로 각 컬럼의 값을 함수에 전달.
- 사과->cnt1, 귤->cnt1, 사과-> cnt2, 귤->cnt2


```python
df.groupby('fruits').transform('mean')
```

<div>
<h1>
이게 됩니까?
</h1>
</div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cnt1</th>
      <th>cnt2</th>
      <th>cnt2</th>
      <th>cnt2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>11.6</td>
      <td>103.6</td>
    </tr>
    <tr>
      <th>1</th>
      <td>11.6</td>
      <td>103.6</td>
    </tr>
    <tr>
      <th>2</th>
      <td>11.6</td>
      <td>103.6</td>
    </tr>
    <tr>
      <th>3</th>
      <td>11.6</td>
      <td>103.6</td>
    </tr>
    <tr>
      <th>4</th>
      <td>11.6</td>
      <td>103.6</td>
    </tr>
    <tr>
      <th>5</th>
      <td>24.0</td>
      <td>54.8</td>
    </tr>
    <tr>
      <th>6</th>
      <td>24.0</td>
      <td>54.8</td>
    </tr>
    <tr>
      <th>7</th>
      <td>24.0</td>
      <td>54.8</td>
    </tr>
    <tr>
      <th>8</th>
      <td>24.0</td>
      <td>54.8</td>
    </tr>
    <tr>
      <th>9</th>
      <td>24.0</td>
      <td>54.8</td>
    </tr>
    <tr>
      <th>10</th>
      <td>5.4</td>
      <td>7.4</td>
    </tr>
    <tr>
      <th>11</th>
      <td>5.4</td>
      <td>7.4</td>
    </tr>
    <tr>
      <th>12</th>
      <td>5.4</td>
      <td>7.4</td>
    </tr>
    <tr>
      <th>13</th>
      <td>5.4</td>
      <td>7.4</td>
    </tr>
    <tr>
      <th>14</th>
      <td>5.4</td>
      <td>7.4</td>
    </tr>
    <tr>
      <th>15</th>
      <td>34.2</td>
      <td>209.6</td>
    </tr>
    <tr>
      <th>16</th>
      <td>34.2</td>
      <td>209.6</td>
    </tr>
    <tr>
      <th>17</th>
      <td>34.2</td>
      <td>209.6</td>
    </tr>
    <tr>
      <th>18</th>
      <td>34.2</td>
      <td>209.6</td>
    </tr>
    <tr>
      <th>19</th>
      <td>34.2</td>
      <td>209.6</td>
    </tr>
  </tbody>
</table>
</div>




```python
df.groupby('fruits')['cnt1'].transform('mean')
```




    0     11.6
    1     11.6
    2     11.6
    3     11.6
    4     11.6
    5     24.0
    6     24.0
    7     24.0
    8     24.0
    9     24.0
    10     5.4
    11     5.4
    12     5.4
    13     5.4
    14     5.4
    15    34.2
    16    34.2
    17    34.2
    18    34.2
    19    34.2
    Name: cnt1, dtype: float64




```python
result = df.groupby('fruits').transform('mean')
result
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cnt1</th>
      <th>cnt2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>11.6</td>
      <td>103.6</td>
    </tr>
    <tr>
      <th>1</th>
      <td>11.6</td>
      <td>103.6</td>
    </tr>
    <tr>
      <th>2</th>
      <td>11.6</td>
      <td>103.6</td>
    </tr>
    <tr>
      <th>3</th>
      <td>11.6</td>
      <td>103.6</td>
    </tr>
    <tr>
      <th>4</th>
      <td>11.6</td>
      <td>103.6</td>
    </tr>
    <tr>
      <th>5</th>
      <td>24.0</td>
      <td>54.8</td>
    </tr>
    <tr>
      <th>6</th>
      <td>24.0</td>
      <td>54.8</td>
    </tr>
    <tr>
      <th>7</th>
      <td>24.0</td>
      <td>54.8</td>
    </tr>
    <tr>
      <th>8</th>
      <td>24.0</td>
      <td>54.8</td>
    </tr>
    <tr>
      <th>9</th>
      <td>24.0</td>
      <td>54.8</td>
    </tr>
    <tr>
      <th>10</th>
      <td>5.4</td>
      <td>7.4</td>
    </tr>
    <tr>
      <th>11</th>
      <td>5.4</td>
      <td>7.4</td>
    </tr>
    <tr>
      <th>12</th>
      <td>5.4</td>
      <td>7.4</td>
    </tr>
    <tr>
      <th>13</th>
      <td>5.4</td>
      <td>7.4</td>
    </tr>
    <tr>
      <th>14</th>
      <td>5.4</td>
      <td>7.4</td>
    </tr>
    <tr>
      <th>15</th>
      <td>34.2</td>
      <td>209.6</td>
    </tr>
    <tr>
      <th>16</th>
      <td>34.2</td>
      <td>209.6</td>
    </tr>
    <tr>
      <th>17</th>
      <td>34.2</td>
      <td>209.6</td>
    </tr>
    <tr>
      <th>18</th>
      <td>34.2</td>
      <td>209.6</td>
    </tr>
    <tr>
      <th>19</th>
      <td>34.2</td>
      <td>209.6</td>
    </tr>
  </tbody>
</table>
</div>



- 컬럼(열) 삽입 - df.insert(삽입할 컬럼 순번, 컬럼이름, 값들)


```python
df.insert(1, "cnt1평균", result['cnt1'])
df
```


```python
df['cnt2평균'] = result['cnt2']
df
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fruits</th>
      <th>cnt1평균</th>
      <th>cnt1</th>
      <th>cnt2</th>
      <th>cnt2평균</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>사과</td>
      <td>11.6</td>
      <td>10</td>
      <td>100</td>
      <td>103.6</td>
    </tr>
    <tr>
      <th>1</th>
      <td>사과</td>
      <td>11.6</td>
      <td>12</td>
      <td>103</td>
      <td>103.6</td>
    </tr>
    <tr>
      <th>2</th>
      <td>사과</td>
      <td>11.6</td>
      <td>13</td>
      <td>107</td>
      <td>103.6</td>
    </tr>
    <tr>
      <th>3</th>
      <td>사과</td>
      <td>11.6</td>
      <td>11</td>
      <td>107</td>
      <td>103.6</td>
    </tr>
    <tr>
      <th>4</th>
      <td>사과</td>
      <td>11.6</td>
      <td>12</td>
      <td>101</td>
      <td>103.6</td>
    </tr>
    <tr>
      <th>5</th>
      <td>귤</td>
      <td>24.0</td>
      <td>21</td>
      <td>51</td>
      <td>54.8</td>
    </tr>
    <tr>
      <th>6</th>
      <td>귤</td>
      <td>24.0</td>
      <td>22</td>
      <td>57</td>
      <td>54.8</td>
    </tr>
    <tr>
      <th>7</th>
      <td>귤</td>
      <td>24.0</td>
      <td>27</td>
      <td>58</td>
      <td>54.8</td>
    </tr>
    <tr>
      <th>8</th>
      <td>귤</td>
      <td>24.0</td>
      <td>24</td>
      <td>57</td>
      <td>54.8</td>
    </tr>
    <tr>
      <th>9</th>
      <td>귤</td>
      <td>24.0</td>
      <td>26</td>
      <td>51</td>
      <td>54.8</td>
    </tr>
    <tr>
      <th>10</th>
      <td>배</td>
      <td>5.4</td>
      <td>7</td>
      <td>9</td>
      <td>7.4</td>
    </tr>
    <tr>
      <th>11</th>
      <td>배</td>
      <td>5.4</td>
      <td>7</td>
      <td>9</td>
      <td>7.4</td>
    </tr>
    <tr>
      <th>12</th>
      <td>배</td>
      <td>5.4</td>
      <td>8</td>
      <td>5</td>
      <td>7.4</td>
    </tr>
    <tr>
      <th>13</th>
      <td>배</td>
      <td>5.4</td>
      <td>3</td>
      <td>7</td>
      <td>7.4</td>
    </tr>
    <tr>
      <th>14</th>
      <td>배</td>
      <td>5.4</td>
      <td>2</td>
      <td>7</td>
      <td>7.4</td>
    </tr>
    <tr>
      <th>15</th>
      <td>딸기</td>
      <td>34.2</td>
      <td>30</td>
      <td>208</td>
      <td>209.6</td>
    </tr>
    <tr>
      <th>16</th>
      <td>딸기</td>
      <td>34.2</td>
      <td>35</td>
      <td>217</td>
      <td>209.6</td>
    </tr>
    <tr>
      <th>17</th>
      <td>딸기</td>
      <td>34.2</td>
      <td>37</td>
      <td>213</td>
      <td>209.6</td>
    </tr>
    <tr>
      <th>18</th>
      <td>딸기</td>
      <td>34.2</td>
      <td>41</td>
      <td>206</td>
      <td>209.6</td>
    </tr>
    <tr>
      <th>19</th>
      <td>딸기</td>
      <td>34.2</td>
      <td>28</td>
      <td>204</td>
      <td>209.6</td>
    </tr>
  </tbody>
</table>
</div>




```python
df2 = pd.DataFrame(data)
```


```python
df2.sample(n=3) # random하게 행을 추출해준다.
df2.sample(frac=0.3) # 비율 (전체중 30%의 행만 추출)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fruits</th>
      <th>cnt1</th>
      <th>cnt2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>12</th>
      <td>배</td>
      <td>8</td>
      <td>5</td>
    </tr>
    <tr>
      <th>2</th>
      <td>사과</td>
      <td>13</td>
      <td>107</td>
    </tr>
    <tr>
      <th>18</th>
      <td>딸기</td>
      <td>41</td>
      <td>206</td>
    </tr>
    <tr>
      <th>14</th>
      <td>배</td>
      <td>2</td>
      <td>7</td>
    </tr>
    <tr>
      <th>8</th>
      <td>귤</td>
      <td>24</td>
      <td>57</td>
    </tr>
    <tr>
      <th>10</th>
      <td>배</td>
      <td>7</td>
      <td>9</td>
    </tr>
  </tbody>
</table>
</div>




```python
df2 = df2.sample(frac=1) # frac= 1.0 -> 섞기만 하겠다.
df2.reset_index(drop=True)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fruits</th>
      <th>cnt1</th>
      <th>cnt2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>귤</td>
      <td>24</td>
      <td>57</td>
    </tr>
    <tr>
      <th>1</th>
      <td>사과</td>
      <td>13</td>
      <td>107</td>
    </tr>
    <tr>
      <th>2</th>
      <td>딸기</td>
      <td>37</td>
      <td>213</td>
    </tr>
    <tr>
      <th>3</th>
      <td>딸기</td>
      <td>41</td>
      <td>206</td>
    </tr>
    <tr>
      <th>4</th>
      <td>딸기</td>
      <td>35</td>
      <td>217</td>
    </tr>
    <tr>
      <th>5</th>
      <td>사과</td>
      <td>12</td>
      <td>101</td>
    </tr>
    <tr>
      <th>6</th>
      <td>딸기</td>
      <td>28</td>
      <td>204</td>
    </tr>
    <tr>
      <th>7</th>
      <td>사과</td>
      <td>11</td>
      <td>107</td>
    </tr>
    <tr>
      <th>8</th>
      <td>배</td>
      <td>2</td>
      <td>7</td>
    </tr>
    <tr>
      <th>9</th>
      <td>배</td>
      <td>7</td>
      <td>9</td>
    </tr>
    <tr>
      <th>10</th>
      <td>귤</td>
      <td>27</td>
      <td>58</td>
    </tr>
    <tr>
      <th>11</th>
      <td>배</td>
      <td>3</td>
      <td>7</td>
    </tr>
    <tr>
      <th>12</th>
      <td>딸기</td>
      <td>30</td>
      <td>208</td>
    </tr>
    <tr>
      <th>13</th>
      <td>사과</td>
      <td>10</td>
      <td>100</td>
    </tr>
    <tr>
      <th>14</th>
      <td>귤</td>
      <td>21</td>
      <td>51</td>
    </tr>
    <tr>
      <th>15</th>
      <td>사과</td>
      <td>12</td>
      <td>103</td>
    </tr>
    <tr>
      <th>16</th>
      <td>귤</td>
      <td>26</td>
      <td>51</td>
    </tr>
    <tr>
      <th>17</th>
      <td>배</td>
      <td>8</td>
      <td>5</td>
    </tr>
    <tr>
      <th>18</th>
      <td>귤</td>
      <td>22</td>
      <td>57</td>
    </tr>
    <tr>
      <th>19</th>
      <td>배</td>
      <td>7</td>
      <td>9</td>
    </tr>
  </tbody>
</table>
</div>




```python
cnt1_avg = df2.groupby('fruits')['cnt1'].transform('mean')
df2.insert(3, '과일별 cnt1평균', cnt1_avg)
df2
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fruits</th>
      <th>cnt1</th>
      <th>cnt2</th>
      <th>과일별 cnt1평균</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>8</th>
      <td>귤</td>
      <td>24</td>
      <td>57</td>
      <td>24.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>사과</td>
      <td>13</td>
      <td>107</td>
      <td>11.6</td>
    </tr>
    <tr>
      <th>17</th>
      <td>딸기</td>
      <td>37</td>
      <td>213</td>
      <td>34.2</td>
    </tr>
    <tr>
      <th>18</th>
      <td>딸기</td>
      <td>41</td>
      <td>206</td>
      <td>34.2</td>
    </tr>
    <tr>
      <th>16</th>
      <td>딸기</td>
      <td>35</td>
      <td>217</td>
      <td>34.2</td>
    </tr>
    <tr>
      <th>4</th>
      <td>사과</td>
      <td>12</td>
      <td>101</td>
      <td>11.6</td>
    </tr>
    <tr>
      <th>19</th>
      <td>딸기</td>
      <td>28</td>
      <td>204</td>
      <td>34.2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>사과</td>
      <td>11</td>
      <td>107</td>
      <td>11.6</td>
    </tr>
    <tr>
      <th>14</th>
      <td>배</td>
      <td>2</td>
      <td>7</td>
      <td>5.4</td>
    </tr>
    <tr>
      <th>10</th>
      <td>배</td>
      <td>7</td>
      <td>9</td>
      <td>5.4</td>
    </tr>
    <tr>
      <th>7</th>
      <td>귤</td>
      <td>27</td>
      <td>58</td>
      <td>24.0</td>
    </tr>
    <tr>
      <th>13</th>
      <td>배</td>
      <td>3</td>
      <td>7</td>
      <td>5.4</td>
    </tr>
    <tr>
      <th>15</th>
      <td>딸기</td>
      <td>30</td>
      <td>208</td>
      <td>34.2</td>
    </tr>
    <tr>
      <th>0</th>
      <td>사과</td>
      <td>10</td>
      <td>100</td>
      <td>11.6</td>
    </tr>
    <tr>
      <th>5</th>
      <td>귤</td>
      <td>21</td>
      <td>51</td>
      <td>24.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>사과</td>
      <td>12</td>
      <td>103</td>
      <td>11.6</td>
    </tr>
    <tr>
      <th>9</th>
      <td>귤</td>
      <td>26</td>
      <td>51</td>
      <td>24.0</td>
    </tr>
    <tr>
      <th>12</th>
      <td>배</td>
      <td>8</td>
      <td>5</td>
      <td>5.4</td>
    </tr>
    <tr>
      <th>6</th>
      <td>귤</td>
      <td>22</td>
      <td>57</td>
      <td>24.0</td>
    </tr>
    <tr>
      <th>11</th>
      <td>배</td>
      <td>7</td>
      <td>9</td>
      <td>5.4</td>
    </tr>
  </tbody>
</table>
</div>



## 결측치 처리
- transform이용해서 결측치를 같은 과일별 평균값으로 변환
    - 전체 평균보다 좀더 정확할 수 있다.


```python
import numpy as np
s = pd.Series([1, np.nan, 2, np.nan])
s
```




    0    1.0
    1    NaN
    2    2.0
    3    NaN
    dtype: float64



-  결측치(nan)을 다른값을 대체(변경)


```python
s.fillna(20) # 모든 결측치값을 20으로 변경
```




    0     1.0
    1    20.0
    2     2.0
    3    20.0
    dtype: float64



- s.fillna(s와 동일한 크기의 Series) -> 결측치는 결측치와 같은 index의 값으로 변경. 결측치 아닌 것들은 유지.


```python
s.fillna(pd.Series([100,200,300,400]))
```




    0      1.0
    1    200.0
    2      2.0
    3    400.0
    dtype: float64




```python
df3 = pd.DataFrame(data)
df3.loc[[0, 1, 5, 6, 10, 11, 15, 16], 'cnt2'] = np.nan
df3
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fruits</th>
      <th>cnt1</th>
      <th>cnt2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>사과</td>
      <td>10</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>사과</td>
      <td>12</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>사과</td>
      <td>13</td>
      <td>107.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>사과</td>
      <td>11</td>
      <td>107.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>사과</td>
      <td>12</td>
      <td>101.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>귤</td>
      <td>21</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>6</th>
      <td>귤</td>
      <td>22</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>7</th>
      <td>귤</td>
      <td>27</td>
      <td>58.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>귤</td>
      <td>24</td>
      <td>57.0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>귤</td>
      <td>26</td>
      <td>51.0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>배</td>
      <td>7</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>11</th>
      <td>배</td>
      <td>7</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>12</th>
      <td>배</td>
      <td>8</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>13</th>
      <td>배</td>
      <td>3</td>
      <td>7.0</td>
    </tr>
    <tr>
      <th>14</th>
      <td>배</td>
      <td>2</td>
      <td>7.0</td>
    </tr>
    <tr>
      <th>15</th>
      <td>딸기</td>
      <td>30</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>16</th>
      <td>딸기</td>
      <td>35</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>17</th>
      <td>딸기</td>
      <td>37</td>
      <td>213.0</td>
    </tr>
    <tr>
      <th>18</th>
      <td>딸기</td>
      <td>41</td>
      <td>206.0</td>
    </tr>
    <tr>
      <th>19</th>
      <td>딸기</td>
      <td>28</td>
      <td>204.0</td>
    </tr>
  </tbody>
</table>
</div>



- DataFrame 에서 결측치를 제거 -> 행 제거. axis=1 하면 컬럼(열)을 제거.


```python
df3.dropna()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fruits</th>
      <th>cnt1</th>
      <th>cnt2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2</th>
      <td>사과</td>
      <td>13</td>
      <td>107.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>사과</td>
      <td>11</td>
      <td>107.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>사과</td>
      <td>12</td>
      <td>101.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>귤</td>
      <td>27</td>
      <td>58.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>귤</td>
      <td>24</td>
      <td>57.0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>귤</td>
      <td>26</td>
      <td>51.0</td>
    </tr>
    <tr>
      <th>12</th>
      <td>배</td>
      <td>8</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>13</th>
      <td>배</td>
      <td>3</td>
      <td>7.0</td>
    </tr>
    <tr>
      <th>14</th>
      <td>배</td>
      <td>2</td>
      <td>7.0</td>
    </tr>
    <tr>
      <th>17</th>
      <td>딸기</td>
      <td>37</td>
      <td>213.0</td>
    </tr>
    <tr>
      <th>18</th>
      <td>딸기</td>
      <td>41</td>
      <td>206.0</td>
    </tr>
    <tr>
      <th>19</th>
      <td>딸기</td>
      <td>28</td>
      <td>204.0</td>
    </tr>
  </tbody>
</table>
</div>




```python
cnt2_mean = df3['cnt2'].mean()
cnt2_mean
```




    93.58333333333333




```python
df3['cnt2'] = df3['cnt2'].fillna(round(cnt2_mean)) #결측치가 채워짐
df3
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fruits</th>
      <th>cnt1</th>
      <th>cnt2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>사과</td>
      <td>10</td>
      <td>94.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>사과</td>
      <td>12</td>
      <td>94.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>사과</td>
      <td>13</td>
      <td>107.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>사과</td>
      <td>11</td>
      <td>107.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>사과</td>
      <td>12</td>
      <td>101.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>귤</td>
      <td>21</td>
      <td>94.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>귤</td>
      <td>22</td>
      <td>94.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>귤</td>
      <td>27</td>
      <td>58.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>귤</td>
      <td>24</td>
      <td>57.0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>귤</td>
      <td>26</td>
      <td>51.0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>배</td>
      <td>7</td>
      <td>94.0</td>
    </tr>
    <tr>
      <th>11</th>
      <td>배</td>
      <td>7</td>
      <td>94.0</td>
    </tr>
    <tr>
      <th>12</th>
      <td>배</td>
      <td>8</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>13</th>
      <td>배</td>
      <td>3</td>
      <td>7.0</td>
    </tr>
    <tr>
      <th>14</th>
      <td>배</td>
      <td>2</td>
      <td>7.0</td>
    </tr>
    <tr>
      <th>15</th>
      <td>딸기</td>
      <td>30</td>
      <td>94.0</td>
    </tr>
    <tr>
      <th>16</th>
      <td>딸기</td>
      <td>35</td>
      <td>94.0</td>
    </tr>
    <tr>
      <th>17</th>
      <td>딸기</td>
      <td>37</td>
      <td>213.0</td>
    </tr>
    <tr>
      <th>18</th>
      <td>딸기</td>
      <td>41</td>
      <td>206.0</td>
    </tr>
    <tr>
      <th>19</th>
      <td>딸기</td>
      <td>28</td>
      <td>204.0</td>
    </tr>
  </tbody>
</table>
</div>




```python
df3['cnt2'] = df3['cnt2'].fillna(round(df3.groupby('fruits')['cnt2'].transform('mean')))
df3
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fruits</th>
      <th>cnt1</th>
      <th>cnt2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>사과</td>
      <td>10</td>
      <td>105.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>사과</td>
      <td>12</td>
      <td>105.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>사과</td>
      <td>13</td>
      <td>107.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>사과</td>
      <td>11</td>
      <td>107.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>사과</td>
      <td>12</td>
      <td>101.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>귤</td>
      <td>21</td>
      <td>55.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>귤</td>
      <td>22</td>
      <td>55.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>귤</td>
      <td>27</td>
      <td>58.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>귤</td>
      <td>24</td>
      <td>57.0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>귤</td>
      <td>26</td>
      <td>51.0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>배</td>
      <td>7</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>11</th>
      <td>배</td>
      <td>7</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>12</th>
      <td>배</td>
      <td>8</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>13</th>
      <td>배</td>
      <td>3</td>
      <td>7.0</td>
    </tr>
    <tr>
      <th>14</th>
      <td>배</td>
      <td>2</td>
      <td>7.0</td>
    </tr>
    <tr>
      <th>15</th>
      <td>딸기</td>
      <td>30</td>
      <td>208.0</td>
    </tr>
    <tr>
      <th>16</th>
      <td>딸기</td>
      <td>35</td>
      <td>208.0</td>
    </tr>
    <tr>
      <th>17</th>
      <td>딸기</td>
      <td>37</td>
      <td>213.0</td>
    </tr>
    <tr>
      <th>18</th>
      <td>딸기</td>
      <td>41</td>
      <td>206.0</td>
    </tr>
    <tr>
      <th>19</th>
      <td>딸기</td>
      <td>28</td>
      <td>204.0</td>
    </tr>
  </tbody>
</table>
</div>



# <b style='font-size:2em'>TODO </b>

## 1.  data/diamonds.csv 조회


```python
dia = pd.read_csv('data/diamonds.csv')
dia
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>carat</th>
      <th>cut</th>
      <th>color</th>
      <th>clarity</th>
      <th>depth</th>
      <th>table</th>
      <th>price</th>
      <th>x</th>
      <th>y</th>
      <th>z</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.23</td>
      <td>Ideal</td>
      <td>E</td>
      <td>SI2</td>
      <td>61.5</td>
      <td>55.0</td>
      <td>326</td>
      <td>3.95</td>
      <td>3.98</td>
      <td>2.43</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.21</td>
      <td>Premium</td>
      <td>E</td>
      <td>SI1</td>
      <td>59.8</td>
      <td>61.0</td>
      <td>326</td>
      <td>3.89</td>
      <td>3.84</td>
      <td>2.31</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.23</td>
      <td>Good</td>
      <td>E</td>
      <td>VS1</td>
      <td>56.9</td>
      <td>65.0</td>
      <td>327</td>
      <td>4.05</td>
      <td>4.07</td>
      <td>2.31</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.29</td>
      <td>Premium</td>
      <td>I</td>
      <td>VS2</td>
      <td>62.4</td>
      <td>58.0</td>
      <td>334</td>
      <td>4.20</td>
      <td>4.23</td>
      <td>2.63</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.31</td>
      <td>Good</td>
      <td>J</td>
      <td>SI2</td>
      <td>63.3</td>
      <td>58.0</td>
      <td>335</td>
      <td>4.34</td>
      <td>4.35</td>
      <td>2.75</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>53935</th>
      <td>0.72</td>
      <td>Ideal</td>
      <td>D</td>
      <td>SI1</td>
      <td>60.8</td>
      <td>57.0</td>
      <td>2757</td>
      <td>5.75</td>
      <td>5.76</td>
      <td>3.50</td>
    </tr>
    <tr>
      <th>53936</th>
      <td>0.72</td>
      <td>Good</td>
      <td>D</td>
      <td>SI1</td>
      <td>63.1</td>
      <td>55.0</td>
      <td>2757</td>
      <td>5.69</td>
      <td>5.75</td>
      <td>3.61</td>
    </tr>
    <tr>
      <th>53937</th>
      <td>0.70</td>
      <td>Very Good</td>
      <td>D</td>
      <td>SI1</td>
      <td>62.8</td>
      <td>60.0</td>
      <td>2757</td>
      <td>5.66</td>
      <td>5.68</td>
      <td>3.56</td>
    </tr>
    <tr>
      <th>53938</th>
      <td>0.86</td>
      <td>Premium</td>
      <td>H</td>
      <td>SI2</td>
      <td>61.0</td>
      <td>58.0</td>
      <td>2757</td>
      <td>6.15</td>
      <td>6.12</td>
      <td>3.74</td>
    </tr>
    <tr>
      <th>53939</th>
      <td>0.75</td>
      <td>Ideal</td>
      <td>D</td>
      <td>SI2</td>
      <td>62.2</td>
      <td>55.0</td>
      <td>2757</td>
      <td>5.83</td>
      <td>5.87</td>
      <td>3.64</td>
    </tr>
  </tbody>
</table>
<p>53940 rows × 10 columns</p>
</div>



## 2.  cut 별 평균 가격이 4000 이상인 diamond 데이터들 조회 
- cut 별 평균가격.


```python
dia1 = dia.groupby('cut')['price'].mean()
```


```python
dia1[dia1 >= 4000]
```




    cut
    Fair       4358.757764
    Premium    4584.257704
    Name: price, dtype: float64




```python
result = dia.groupby('cut').filter(lambda x : x['price'].mean() >= 4000)
result['cut'].value_counts()
```




    Premium    13791
    Fair        1610
    Name: cut, dtype: int64




```python
def check_mean(x):
    return x['price'].mean()>=4000
dia.groupby('cut').filter(check_mean)['cut'].value_counts()
```




    Premium    13791
    Fair        1610
    Name: cut, dtype: int64



## 3. color 별 carat의 최대값과 최소값의 차이가 2이상 3미만인 모든 diamond 데이터들 조회


```python
def dia_data(x):
    diff = x['carat'].max() - x['carat'].min()
    return diff >= 2 and diff < 3
result4 = dia.groupby('color').filter(dia_data)
result4
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>carat</th>
      <th>cut</th>
      <th>color</th>
      <th>clarity</th>
      <th>depth</th>
      <th>table</th>
      <th>price</th>
      <th>x</th>
      <th>y</th>
      <th>z</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.23</td>
      <td>Ideal</td>
      <td>E</td>
      <td>SI2</td>
      <td>61.5</td>
      <td>55.0</td>
      <td>326</td>
      <td>3.95</td>
      <td>3.98</td>
      <td>2.43</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.21</td>
      <td>Premium</td>
      <td>E</td>
      <td>SI1</td>
      <td>59.8</td>
      <td>61.0</td>
      <td>326</td>
      <td>3.89</td>
      <td>3.84</td>
      <td>2.31</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.23</td>
      <td>Good</td>
      <td>E</td>
      <td>VS1</td>
      <td>56.9</td>
      <td>65.0</td>
      <td>327</td>
      <td>4.05</td>
      <td>4.07</td>
      <td>2.31</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0.22</td>
      <td>Fair</td>
      <td>E</td>
      <td>VS2</td>
      <td>65.1</td>
      <td>61.0</td>
      <td>337</td>
      <td>3.87</td>
      <td>3.78</td>
      <td>2.49</td>
    </tr>
    <tr>
      <th>12</th>
      <td>0.22</td>
      <td>Premium</td>
      <td>F</td>
      <td>SI1</td>
      <td>60.4</td>
      <td>61.0</td>
      <td>342</td>
      <td>3.88</td>
      <td>3.84</td>
      <td>2.33</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>53929</th>
      <td>0.71</td>
      <td>Ideal</td>
      <td>G</td>
      <td>VS1</td>
      <td>61.4</td>
      <td>56.0</td>
      <td>2756</td>
      <td>5.76</td>
      <td>5.73</td>
      <td>3.53</td>
    </tr>
    <tr>
      <th>53930</th>
      <td>0.71</td>
      <td>Premium</td>
      <td>E</td>
      <td>SI1</td>
      <td>60.5</td>
      <td>55.0</td>
      <td>2756</td>
      <td>5.79</td>
      <td>5.74</td>
      <td>3.49</td>
    </tr>
    <tr>
      <th>53931</th>
      <td>0.71</td>
      <td>Premium</td>
      <td>F</td>
      <td>SI1</td>
      <td>59.8</td>
      <td>62.0</td>
      <td>2756</td>
      <td>5.74</td>
      <td>5.73</td>
      <td>3.43</td>
    </tr>
    <tr>
      <th>53932</th>
      <td>0.70</td>
      <td>Very Good</td>
      <td>E</td>
      <td>VS2</td>
      <td>60.5</td>
      <td>59.0</td>
      <td>2757</td>
      <td>5.71</td>
      <td>5.76</td>
      <td>3.47</td>
    </tr>
    <tr>
      <th>53933</th>
      <td>0.70</td>
      <td>Very Good</td>
      <td>E</td>
      <td>VS2</td>
      <td>61.2</td>
      <td>59.0</td>
      <td>2757</td>
      <td>5.69</td>
      <td>5.72</td>
      <td>3.49</td>
    </tr>
  </tbody>
</table>
<p>30631 rows × 10 columns</p>
</div>




```python
dia.groupby('color')['carat'].agg(lambda x : x.max() - x.min()) # 결과 확인
```




    color
    D    3.20
    E    2.85
    F    2.81
    G    2.78
    H    3.90
    I    3.78
    J    4.78
    Name: carat, dtype: float64



## 4. clarity 별 평균 가격 컬럼을 DataFrame에 추가.


```python
result2 = dia.groupby('clarity')['price'].transform('mean')
dia2.insert(2,'clarity 평균가격임', round(result2))
```


```python
dia2.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>carat</th>
      <th>cut</th>
      <th>clarity 평균가격임</th>
      <th>color</th>
      <th>clarity</th>
      <th>depth</th>
      <th>table</th>
      <th>price</th>
      <th>x</th>
      <th>y</th>
      <th>z</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.23</td>
      <td>Ideal</td>
      <td>5063.0</td>
      <td>E</td>
      <td>SI2</td>
      <td>61.5</td>
      <td>55.0</td>
      <td>326</td>
      <td>3.95</td>
      <td>3.98</td>
      <td>2.43</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.21</td>
      <td>Premium</td>
      <td>3996.0</td>
      <td>E</td>
      <td>SI1</td>
      <td>59.8</td>
      <td>61.0</td>
      <td>326</td>
      <td>3.89</td>
      <td>3.84</td>
      <td>2.31</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.23</td>
      <td>Good</td>
      <td>3839.0</td>
      <td>E</td>
      <td>VS1</td>
      <td>56.9</td>
      <td>65.0</td>
      <td>327</td>
      <td>4.05</td>
      <td>4.07</td>
      <td>2.31</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.29</td>
      <td>Premium</td>
      <td>3925.0</td>
      <td>I</td>
      <td>VS2</td>
      <td>62.4</td>
      <td>58.0</td>
      <td>334</td>
      <td>4.20</td>
      <td>4.23</td>
      <td>2.63</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.31</td>
      <td>Good</td>
      <td>5063.0</td>
      <td>J</td>
      <td>SI2</td>
      <td>63.3</td>
      <td>58.0</td>
      <td>335</td>
      <td>4.34</td>
      <td>4.35</td>
      <td>2.75</td>
    </tr>
  </tbody>
</table>
</div>



# pivot_table()
엑셀의 pivot table 기능을 제공하는 메소드.    
분류별 집계(Group으로 묶어 집계)를 처리하는 함수로 group으로 묶고자 하는 컬럼들을 행과 열로 위치시키고 집계값을 값으로 보여준다.    
역할은 `groupby()`를 이용한 집계와 같은데 **여러개 컬럼을 기준으로 groupby 를 할 경우 집계결과를 읽는 것이 더 편하다.(가독성이 좋다)**

> pivot() 함수와 역할이 다르다.   
> pivot() 은 index와 column의 형태를 바꾸는 reshape 함수.

- `DataFrame.pivot_table(values=None, index=None, columns=None, aggfunc='mean', fill_value=None, margins=False, dropna=True, margins_name='All')`
- **매개변수**
    - **index**
        - 문자열 또는 리스트. index로 올 컬럼들 => groupby였으면 묶었을 컬럼
    - **columns**
        - 문자열 또는 리스트. column으로 올 컬럼들 => groupby였으면 묶었을 컬럼 (index/columns가 묶여서 groupby에 묶을 컬럼들이 된다.)
    - **values**
        - 문자열 또는 리스트. 집계할 대상 컬럼들
    - **aggfunc**
        - 집계함수 지정. 함수, 함수이름문자열, 함수리스트(함수이름 문자열/함수객체), dict: 집계할 함수
        - 기본(생략시): 평균을 구한다. (mean이 기본값)
    - **fill_value, dropna**
        - fill_value: 집계시 NA가 나올경우 채울 값
        - dropna: boolean. 컬럼의 전체값이 NA인 경우 그 컬럼 제거(기본: True)
    - **margins/margins_name**
        - margin: boolean(기본: False). 총집계결과를 만들지 여부.
        - margin_name: margin의 이름 문자열로 지정 (생략시 All)


```python
flights = pd.read_csv('data/flights.csv')
```


```python
flights.groupby(['ORG_AIR','AIRLINE'])['DEP_DELAY'].mean()
```




    ORG_AIR  AIRLINE
    ATL      AA          7.995652
             AS         15.307692
             DL          7.616505
             EV         10.140896
             F9         21.574324
                          ...    
    SFO      OO         11.135827
             UA         13.858655
             US          5.470588
             VX          8.144654
             WN         11.185714
    Name: DEP_DELAY, Length: 114, dtype: float64



## 1개의 컬럼을 grouping 해서 집계
- 항공사별 비행시간의 평균 
- 사용컬럼
    - grouping할 컬럼
        - AIRLINE: 항공사
    - 집계대상컬럼
        - AIR_TIME
- 집계: mean


```python
# flights.groupby('AIRLINE')['AIR_TIME'].mean()
flights.pivot_table(index="AIRLINE",values="AIR_TIME",aggfunc = "mean") # 반환 :DataFrame
flights.pivot_table(columns="AIRLINE",values="AIR_TIME") # aggfunc의 기본은: 평균!!!!
flights.pivot_table(index="AIRLINE", values="AIR_TIME", aggfunc = "mean", margins=True, margins_name='총계')

# 사용할 컬럼이 2개 이상일때만 피벗테이블 사용!!!
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>AIR_TIME</th>
    </tr>
    <tr>
      <th>AIRLINE</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>AA</th>
      <td>144.259404</td>
    </tr>
    <tr>
      <th>AS</th>
      <td>147.845052</td>
    </tr>
    <tr>
      <th>B6</th>
      <td>209.412963</td>
    </tr>
    <tr>
      <th>DL</th>
      <td>115.334187</td>
    </tr>
    <tr>
      <th>EV</th>
      <td>68.964016</td>
    </tr>
    <tr>
      <th>F9</th>
      <td>127.592337</td>
    </tr>
    <tr>
      <th>HA</th>
      <td>338.288288</td>
    </tr>
    <tr>
      <th>MQ</th>
      <td>61.318346</td>
    </tr>
    <tr>
      <th>NK</th>
      <td>135.736878</td>
    </tr>
    <tr>
      <th>OO</th>
      <td>76.010272</td>
    </tr>
    <tr>
      <th>UA</th>
      <td>155.650521</td>
    </tr>
    <tr>
      <th>US</th>
      <td>147.686755</td>
    </tr>
    <tr>
      <th>VX</th>
      <td>154.864097</td>
    </tr>
    <tr>
      <th>WN</th>
      <td>107.005897</td>
    </tr>
    <tr>
      <th>총계</th>
      <td>115.928576</td>
    </tr>
  </tbody>
</table>
</div>




```python
flights.groupby('AIRLINE')['AIR_TIME'].mean().to_frame() # Series -> Dataframe!!!! 'to_frame()'
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>AIR_TIME</th>
    </tr>
    <tr>
      <th>AIRLINE</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>AA</th>
      <td>144.259404</td>
    </tr>
    <tr>
      <th>AS</th>
      <td>147.845052</td>
    </tr>
    <tr>
      <th>B6</th>
      <td>209.412963</td>
    </tr>
    <tr>
      <th>DL</th>
      <td>115.334187</td>
    </tr>
    <tr>
      <th>EV</th>
      <td>68.964016</td>
    </tr>
    <tr>
      <th>F9</th>
      <td>127.592337</td>
    </tr>
    <tr>
      <th>HA</th>
      <td>338.288288</td>
    </tr>
    <tr>
      <th>MQ</th>
      <td>61.318346</td>
    </tr>
    <tr>
      <th>NK</th>
      <td>135.736878</td>
    </tr>
    <tr>
      <th>OO</th>
      <td>76.010272</td>
    </tr>
    <tr>
      <th>UA</th>
      <td>155.650521</td>
    </tr>
    <tr>
      <th>US</th>
      <td>147.686755</td>
    </tr>
    <tr>
      <th>VX</th>
      <td>154.864097</td>
    </tr>
    <tr>
      <th>WN</th>
      <td>107.005897</td>
    </tr>
  </tbody>
</table>
</div>



## 두개의 컬럼을 grouping 해서 집계
- 항공사/출발공항코드 별 취소 총수 (1이 취소이므로 합계를 구한다.)
- 사용컬럼
    - grouping할 컬럼
        - AIRLINE: 항공사
        - ORG_AIR: 출발 공항코드
    - 집계대상컬럼
        - CANCELLED: 취소여부 - 1:취소, 0: 취소안됨
- 집계: sum


```python
flights.groupby(['AIRLINE', "ORG_AIR"])['CANCELLED'].sum()
```




    AIRLINE  ORG_AIR
    AA       ATL         3
             DEN         4
             DFW        86
             IAH         3
             LAS         3
                        ..
    WN       LAS         7
             LAX        32
             MSP         1
             PHX         6
             SFO        25
    Name: CANCELLED, Length: 114, dtype: int64




```python
flights.pivot_table(index="AIRLINE", columns="ORG_AIR", values="CANCELLED",aggfunc="sum",
                   fill_value=-9999, #결측치를 대체할 값. (결측치 - 그 그룹으로 묶인 행이 없음.)
                   margins= True)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>ORG_AIR</th>
      <th>ATL</th>
      <th>DEN</th>
      <th>DFW</th>
      <th>IAH</th>
      <th>LAS</th>
      <th>LAX</th>
      <th>MSP</th>
      <th>ORD</th>
      <th>PHX</th>
      <th>SFO</th>
      <th>All</th>
    </tr>
    <tr>
      <th>AIRLINE</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>AA</th>
      <td>3</td>
      <td>4</td>
      <td>86</td>
      <td>3</td>
      <td>3</td>
      <td>11</td>
      <td>3</td>
      <td>35</td>
      <td>4</td>
      <td>2</td>
      <td>154</td>
    </tr>
    <tr>
      <th>AS</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>B6</th>
      <td>-9999</td>
      <td>0</td>
      <td>0</td>
      <td>-9999</td>
      <td>0</td>
      <td>0</td>
      <td>-9999</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>DL</th>
      <td>28</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>4</td>
      <td>0</td>
      <td>1</td>
      <td>2</td>
      <td>38</td>
    </tr>
    <tr>
      <th>EV</th>
      <td>18</td>
      <td>6</td>
      <td>27</td>
      <td>36</td>
      <td>-9999</td>
      <td>-9999</td>
      <td>6</td>
      <td>53</td>
      <td>0</td>
      <td>-9999</td>
      <td>146</td>
    </tr>
    <tr>
      <th>F9</th>
      <td>0</td>
      <td>2</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>4</td>
      <td>0</td>
      <td>0</td>
      <td>10</td>
    </tr>
    <tr>
      <th>HA</th>
      <td>-9999</td>
      <td>-9999</td>
      <td>-9999</td>
      <td>-9999</td>
      <td>0</td>
      <td>0</td>
      <td>-9999</td>
      <td>-9999</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>MQ</th>
      <td>5</td>
      <td>-9999</td>
      <td>62</td>
      <td>0</td>
      <td>-9999</td>
      <td>0</td>
      <td>0</td>
      <td>85</td>
      <td>-9999</td>
      <td>-9999</td>
      <td>152</td>
    </tr>
    <tr>
      <th>NK</th>
      <td>1</td>
      <td>1</td>
      <td>6</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>3</td>
      <td>10</td>
      <td>2</td>
      <td>-9999</td>
      <td>25</td>
    </tr>
    <tr>
      <th>OO</th>
      <td>3</td>
      <td>25</td>
      <td>2</td>
      <td>10</td>
      <td>0</td>
      <td>15</td>
      <td>4</td>
      <td>41</td>
      <td>9</td>
      <td>33</td>
      <td>142</td>
    </tr>
    <tr>
      <th>UA</th>
      <td>2</td>
      <td>9</td>
      <td>1</td>
      <td>23</td>
      <td>3</td>
      <td>6</td>
      <td>2</td>
      <td>25</td>
      <td>3</td>
      <td>19</td>
      <td>93</td>
    </tr>
    <tr>
      <th>US</th>
      <td>0</td>
      <td>0</td>
      <td>2</td>
      <td>2</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>6</td>
      <td>7</td>
      <td>3</td>
      <td>21</td>
    </tr>
    <tr>
      <th>VX</th>
      <td>-9999</td>
      <td>-9999</td>
      <td>-9999</td>
      <td>-9999</td>
      <td>0</td>
      <td>3</td>
      <td>-9999</td>
      <td>0</td>
      <td>-9999</td>
      <td>3</td>
      <td>6</td>
    </tr>
    <tr>
      <th>WN</th>
      <td>9</td>
      <td>13</td>
      <td>-9999</td>
      <td>-9999</td>
      <td>7</td>
      <td>32</td>
      <td>1</td>
      <td>-9999</td>
      <td>6</td>
      <td>25</td>
      <td>93</td>
    </tr>
    <tr>
      <th>All</th>
      <td>69</td>
      <td>61</td>
      <td>187</td>
      <td>74</td>
      <td>17</td>
      <td>70</td>
      <td>24</td>
      <td>259</td>
      <td>32</td>
      <td>88</td>
      <td>881</td>
    </tr>
  </tbody>
</table>
</div>



## 3개 이상의 컬럼을 grouping해서 집계
- 항공사/월/출발공항코드 별 취소 총수 
- grouping할 컬럼
    - AIRLINE:항공사
    - MONTH:월
    - ORG_AIR: 출발지 공항
- 집계 대상컬럼
    - CANCELLED: 취소여부
- 집계 : sum    


```python
flights.groupby(['AIRLINE',"MONTH","ORG_AIR"])['CANCELLED'].sum()
```




    AIRLINE  MONTH  ORG_AIR
    AA       1      ATL        0
                    DEN        0
                    DFW        8
                    IAH        0
                    LAS        0
                              ..
    WN       12     LAS        1
                    LAX        2
                    MSP        0
                    PHX        0
                    SFO        0
    Name: CANCELLED, Length: 1133, dtype: int64




```python
flights.pivot_table(index=['AIRLINE', "ORG_AIR"],columns="MONTH", values = "CANCELLED", aggfunc='sum')
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>MONTH</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
      <th>11</th>
      <th>12</th>
    </tr>
    <tr>
      <th>AIRLINE</th>
      <th>ORG_AIR</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">AA</th>
      <th>ATL</th>
      <td>0.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>DEN</th>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>DFW</th>
      <td>8.0</td>
      <td>33.0</td>
      <td>13.0</td>
      <td>4.0</td>
      <td>8.0</td>
      <td>7.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>IAH</th>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>LAS</th>
      <td>0.0</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>...</th>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th rowspan="5" valign="top">WN</th>
      <th>LAS</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>LAX</th>
      <td>3.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>9.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>MSP</th>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>PHX</th>
      <td>0.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>SFO</th>
      <td>4.0</td>
      <td>5.0</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>6.0</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>114 rows × 11 columns</p>
</div>



## 3개 이상의 컬럼을 grouping해서 집계 2
- 항공사/월/출발공항코드 별 최대/최소 연착시간
- grouping할 컬럼
    - AIRLINE:항공사
    - MONTH:월
    - ORG_AIR: 출발지 공항
- 집계 대상컬럼
    - ARR_DELAY: 연착시간
- 집계 : min, max    


```python
flights.groupby(["AIRLINE","MONTH","ORG_AIR"])['ARR_DELAY'].agg(['min','max'])
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th></th>
      <th>min</th>
      <th>max</th>
    </tr>
    <tr>
      <th>AIRLINE</th>
      <th>MONTH</th>
      <th>ORG_AIR</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">AA</th>
      <th rowspan="5" valign="top">1</th>
      <th>ATL</th>
      <td>-27.0</td>
      <td>26.0</td>
    </tr>
    <tr>
      <th>DEN</th>
      <td>-13.0</td>
      <td>78.0</td>
    </tr>
    <tr>
      <th>DFW</th>
      <td>-39.0</td>
      <td>287.0</td>
    </tr>
    <tr>
      <th>IAH</th>
      <td>-23.0</td>
      <td>63.0</td>
    </tr>
    <tr>
      <th>LAS</th>
      <td>-32.0</td>
      <td>732.0</td>
    </tr>
    <tr>
      <th>...</th>
      <th>...</th>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th rowspan="5" valign="top">WN</th>
      <th rowspan="5" valign="top">12</th>
      <th>LAS</th>
      <td>-52.0</td>
      <td>96.0</td>
    </tr>
    <tr>
      <th>LAX</th>
      <td>-30.0</td>
      <td>493.0</td>
    </tr>
    <tr>
      <th>MSP</th>
      <td>-23.0</td>
      <td>90.0</td>
    </tr>
    <tr>
      <th>PHX</th>
      <td>-30.0</td>
      <td>254.0</td>
    </tr>
    <tr>
      <th>SFO</th>
      <td>-20.0</td>
      <td>215.0</td>
    </tr>
  </tbody>
</table>
<p>1133 rows × 2 columns</p>
</div>




```python
result = flights.pivot_table(index='MONTH',columns=['AIRLINE','ORG_AIR'], values='ARR_DELAY', aggfunc=['min','max'])
```


```python
result.to_excel('saved_data/result.xlsx')
```

# apply() - Series, DataFrame의 데이터 일괄 처리

데이터프레임의 행들과 열들 또는 Series의 원소들에 공통된 처리를 할 때 apply 함수를 이용하면 반복문을 사용하지 않고 일괄 처리가 가능하다.

- DataFrame.apply(함수, axis=0, args=(), \*\*kwarg)
    - 인수로 행이나 열을 받는 함수를 apply 메서드의 인수로 넣으면 데이터프레임의 행이나 열들을 하나씩 함수에 전달한다.
    - 매개변수
        - **함수**: DataFrame의 행들 또는 열들을 전달할 함수
        - **axis**: **0-컬럼(열)을 전달, 1-행을 전달 (기본값 0)**
        - **args**: 함수에 행/열 이외에 전달할 매개변수를 위치기반(순서대로) 튜플로 전달
        - **\*\*kwarg**: 함수에 행/열 이외에 전달할 매개변수를 키워드 인자로 전달
- Series.apply(함수, args=(), \*\*kwarg)
    - 인수로 Series의 원소들을 받는 함수를 apply 메소드의 인수로 넣으면  Series의 원소들을 하나씩 함수로 전달한다.
    - 매개변수
        - **함수**: Series의 원소들을 전달할 함수
        - **args**: 함수에 원소 이외에 전달할 매개변수를 위치기반(순서대로) 튜플로 전달
        - **\*\*kwarg**: 함수에 원소 이외에 전달할 매개변수를 키워드 인자로 전달


```python
import numpy as np
import pandas as pd

a = np.arange(24).reshape(6,4) # agrange(24) 0 ~ 23 1씩 증가하는 정수로 구성된 1차원 배열
# reshape(6,4) 배열의 형태(shape)을 변경 - 6 x 4 2차원 배열로 변환.
df = pd.DataFrame(a, columns=['no1', 'no2', 'no3', 'no4'])
df
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>no1</th>
      <th>no2</th>
      <th>no3</th>
      <th>no4</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>1</td>
      <td>2</td>
      <td>3</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4</td>
      <td>5</td>
      <td>6</td>
      <td>7</td>
    </tr>
    <tr>
      <th>2</th>
      <td>8</td>
      <td>9</td>
      <td>10</td>
      <td>11</td>
    </tr>
    <tr>
      <th>3</th>
      <td>12</td>
      <td>13</td>
      <td>14</td>
      <td>15</td>
    </tr>
    <tr>
      <th>4</th>
      <td>16</td>
      <td>17</td>
      <td>18</td>
      <td>19</td>
    </tr>
    <tr>
      <th>5</th>
      <td>20</td>
      <td>21</td>
      <td>22</td>
      <td>23</td>
    </tr>
  </tbody>
</table>
</div>




```python
def func1(x):
    """
    x : DataFrame.apply() - Series가 전달(열-axis=0/행-axis=1)
        Series.apply() - Series 를 구성하는 원소 하나.
    """
#     print(x.name)
    if x.name in ['no1','no3']:
        return x*100
    else:
        return x/100

```


```python
df.apply(func1)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>no1</th>
      <th>no2</th>
      <th>no3</th>
      <th>no4</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>0.01</td>
      <td>200</td>
      <td>0.03</td>
    </tr>
    <tr>
      <th>1</th>
      <td>400</td>
      <td>0.05</td>
      <td>600</td>
      <td>0.07</td>
    </tr>
    <tr>
      <th>2</th>
      <td>800</td>
      <td>0.09</td>
      <td>1000</td>
      <td>0.11</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1200</td>
      <td>0.13</td>
      <td>1400</td>
      <td>0.15</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1600</td>
      <td>0.17</td>
      <td>1800</td>
      <td>0.19</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2000</td>
      <td>0.21</td>
      <td>2200</td>
      <td>0.23</td>
    </tr>
  </tbody>
</table>
</div>




```python
df['no1'].name # Series를 조회한 컬럼/index 이름
```




    'no1'




```python
df.iloc[3].name
```


```python
df.apply(lambda x : x.max()-x.min()) # 
```




    no1    20
    no2    20
    no3    20
    no4    20
    dtype: int64




```python
def func2(x):
#     print(x)
#     print('---------------')
    return x * 10
```


```python
df['no1'].apply(func2) # Series
```




    0      0
    1     40
    2     80
    3    120
    4    160
    5    200
    Name: no1, dtype: int64




```python
df.apply(lambda x : x.mean() - x.median())
```




    no1    0.0
    no2    0.0
    no3    0.0
    no4    0.0
    dtype: float64



# cut()/qcut() - 연속형(실수)을 범주형으로 변환
- cut() : 지정한 값을 기준으로 구간을 나눠 그룹으로 묶는다.
    - `pd.cut(x, bins,right=True, labels=None)`
    - 매개변수
        - **x**: 범주형으로 바꿀 대상. 1차원 배열형태(Series, 리스트, ndarray)의 자료구조
        - **bins**: 범주로 나눌때의 기준값(구간경계)들을 리스트로 묶어서 전달한다.
        - **right**: 구간경계의 오른쪽(True-기본)을 포함할지 왼쪽(False)을 포함할지
        - **labels**: 각 구간(범주)의 label을 리스트로 전달
            - 생략하면 범위를 범주명으로 사용한다. (ex: (10, 20], ()-포함안함, []-포함)
- qcut() :  대상배열의 최대값 ~ 최소값을 지정한 개수의 동등한 size(**원소의개수**)가 되도록 나눈다.
    - `pd.qcut(x, q, labels)`
    - 매개변수
        - **x**: 나눌 대상. 1차원 배열형태의 자료구조
        - **q**: 나눌 개수
        - **labels**: 각 구간(범주)의 label을 리스트로 전달


```python
import numpy as np
np.random.seed(0)
age = np.random.randint(1, 100, size=30) # 1 ~ 99 사이의 난수 30개
tall = np.round(np.random.normal(170, 10, size=30), 2)
# 평균:  170, 표준편차: 10 인 정규분포를 따르는 난수 30개. 대부분의 난수가 170-10*2 ~ 170+10*2 범위. 평균에 가까운 값들이 많이 생성.
# print(age)
# print(tall)
df = pd.DataFrame({
    '나이': age,
    '키': tall
})
df
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>나이</th>
      <th>키</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>45</td>
      <td>168.18</td>
    </tr>
    <tr>
      <th>1</th>
      <td>48</td>
      <td>184.10</td>
    </tr>
    <tr>
      <th>2</th>
      <td>65</td>
      <td>166.26</td>
    </tr>
    <tr>
      <th>3</th>
      <td>68</td>
      <td>172.75</td>
    </tr>
    <tr>
      <th>4</th>
      <td>68</td>
      <td>160.39</td>
    </tr>
    <tr>
      <th>5</th>
      <td>10</td>
      <td>173.77</td>
    </tr>
    <tr>
      <th>6</th>
      <td>84</td>
      <td>170.33</td>
    </tr>
    <tr>
      <th>7</th>
      <td>22</td>
      <td>176.81</td>
    </tr>
    <tr>
      <th>8</th>
      <td>37</td>
      <td>154.37</td>
    </tr>
    <tr>
      <th>9</th>
      <td>88</td>
      <td>164.33</td>
    </tr>
    <tr>
      <th>10</th>
      <td>71</td>
      <td>167.58</td>
    </tr>
    <tr>
      <th>11</th>
      <td>89</td>
      <td>185.14</td>
    </tr>
    <tr>
      <th>12</th>
      <td>89</td>
      <td>166.67</td>
    </tr>
    <tr>
      <th>13</th>
      <td>13</td>
      <td>170.47</td>
    </tr>
    <tr>
      <th>14</th>
      <td>59</td>
      <td>184.63</td>
    </tr>
    <tr>
      <th>15</th>
      <td>66</td>
      <td>185.35</td>
    </tr>
    <tr>
      <th>16</th>
      <td>40</td>
      <td>175.66</td>
    </tr>
    <tr>
      <th>17</th>
      <td>88</td>
      <td>171.49</td>
    </tr>
    <tr>
      <th>18</th>
      <td>47</td>
      <td>159.22</td>
    </tr>
    <tr>
      <th>19</th>
      <td>89</td>
      <td>183.95</td>
    </tr>
    <tr>
      <th>20</th>
      <td>82</td>
      <td>187.87</td>
    </tr>
    <tr>
      <th>21</th>
      <td>38</td>
      <td>164.30</td>
    </tr>
    <tr>
      <th>22</th>
      <td>26</td>
      <td>171.75</td>
    </tr>
    <tr>
      <th>23</th>
      <td>78</td>
      <td>165.37</td>
    </tr>
    <tr>
      <th>24</th>
      <td>73</td>
      <td>159.14</td>
    </tr>
    <tr>
      <th>25</th>
      <td>10</td>
      <td>176.40</td>
    </tr>
    <tr>
      <th>26</th>
      <td>21</td>
      <td>166.14</td>
    </tr>
    <tr>
      <th>27</th>
      <td>81</td>
      <td>162.24</td>
    </tr>
    <tr>
      <th>28</th>
      <td>70</td>
      <td>179.96</td>
    </tr>
    <tr>
      <th>29</th>
      <td>80</td>
      <td>150.67</td>
    </tr>
  </tbody>
</table>
</div>




```python
df.나이.value_counts()
```




    89    3
    68    2
    10    2
    88    2
    45    1
    47    1
    70    1
    81    1
    21    1
    73    1
    78    1
    26    1
    38    1
    82    1
    59    1
    40    1
    66    1
    48    1
    13    1
    71    1
    37    1
    22    1
    84    1
    65    1
    80    1
    Name: 나이, dtype: int64




```python
df.키.value_counts()
```




    168.18    1
    184.10    1
    179.96    1
    162.24    1
    166.14    1
    176.40    1
    159.14    1
    165.37    1
    171.75    1
    164.30    1
    187.87    1
    183.95    1
    159.22    1
    171.49    1
    175.66    1
    185.35    1
    184.63    1
    170.47    1
    166.67    1
    185.14    1
    167.58    1
    164.33    1
    154.37    1
    176.81    1
    170.33    1
    173.77    1
    160.39    1
    172.75    1
    166.26    1
    150.67    1
    Name: 키, dtype: int64



ex) 예제 
- (): closed - 불포함, []: openned - 포함 !!!!!!!
- (36.333/62.667] => 36.333 < x <= 62.667


```python
# 연속형 값 - > 볌주형 값(범위로 묶어서 같은 범주로 만든다.) ==> cut()/qcut()
# cut
나이대 = pd.cut(df['나이'],bins=3, #df['나이'] => 같은 범위로 3등분
             right = False,    # closed 방향을 지정. default : right = True
             labels=['나이대1', '나이대2', '나이대3']) # 각 범주의 label 을 지정.
나이대
# - (): closed - 불포함, []: openned - 포함 !!!!!!!
# - (36.333/62.667] => 36.333 < x <= 62.667
```




    0     나이대2
    1     나이대2
    2     나이대3
    3     나이대3
    4     나이대3
    5     나이대1
    6     나이대3
    7     나이대1
    8     나이대2
    9     나이대3
    10    나이대3
    11    나이대3
    12    나이대3
    13    나이대1
    14    나이대2
    15    나이대3
    16    나이대2
    17    나이대3
    18    나이대2
    19    나이대3
    20    나이대3
    21    나이대2
    22    나이대1
    23    나이대3
    24    나이대3
    25    나이대1
    26    나이대1
    27    나이대3
    28    나이대3
    29    나이대3
    Name: 나이, dtype: category
    Categories (3, object): ['나이대1' < '나이대2' < '나이대3']




```python
df['나이대1'] = 나이대
df
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>나이</th>
      <th>키</th>
      <th>나이대1</th>
      <th>나이대</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>45</td>
      <td>168.18</td>
      <td>나이대2</td>
      <td>장년</td>
    </tr>
    <tr>
      <th>1</th>
      <td>48</td>
      <td>184.10</td>
      <td>나이대2</td>
      <td>장년</td>
    </tr>
    <tr>
      <th>2</th>
      <td>65</td>
      <td>166.26</td>
      <td>나이대3</td>
      <td>노년</td>
    </tr>
    <tr>
      <th>3</th>
      <td>68</td>
      <td>172.75</td>
      <td>나이대3</td>
      <td>노년</td>
    </tr>
    <tr>
      <th>4</th>
      <td>68</td>
      <td>160.39</td>
      <td>나이대3</td>
      <td>노년</td>
    </tr>
    <tr>
      <th>5</th>
      <td>10</td>
      <td>173.77</td>
      <td>나이대1</td>
      <td>청소년</td>
    </tr>
    <tr>
      <th>6</th>
      <td>84</td>
      <td>170.33</td>
      <td>나이대3</td>
      <td>노년</td>
    </tr>
    <tr>
      <th>7</th>
      <td>22</td>
      <td>176.81</td>
      <td>나이대1</td>
      <td>청년</td>
    </tr>
    <tr>
      <th>8</th>
      <td>37</td>
      <td>154.37</td>
      <td>나이대2</td>
      <td>청년</td>
    </tr>
    <tr>
      <th>9</th>
      <td>88</td>
      <td>164.33</td>
      <td>나이대3</td>
      <td>노년</td>
    </tr>
    <tr>
      <th>10</th>
      <td>71</td>
      <td>167.58</td>
      <td>나이대3</td>
      <td>노년</td>
    </tr>
    <tr>
      <th>11</th>
      <td>89</td>
      <td>185.14</td>
      <td>나이대3</td>
      <td>노년</td>
    </tr>
    <tr>
      <th>12</th>
      <td>89</td>
      <td>166.67</td>
      <td>나이대3</td>
      <td>노년</td>
    </tr>
    <tr>
      <th>13</th>
      <td>13</td>
      <td>170.47</td>
      <td>나이대1</td>
      <td>청소년</td>
    </tr>
    <tr>
      <th>14</th>
      <td>59</td>
      <td>184.63</td>
      <td>나이대2</td>
      <td>장년</td>
    </tr>
    <tr>
      <th>15</th>
      <td>66</td>
      <td>185.35</td>
      <td>나이대3</td>
      <td>노년</td>
    </tr>
    <tr>
      <th>16</th>
      <td>40</td>
      <td>175.66</td>
      <td>나이대2</td>
      <td>청년</td>
    </tr>
    <tr>
      <th>17</th>
      <td>88</td>
      <td>171.49</td>
      <td>나이대3</td>
      <td>노년</td>
    </tr>
    <tr>
      <th>18</th>
      <td>47</td>
      <td>159.22</td>
      <td>나이대2</td>
      <td>장년</td>
    </tr>
    <tr>
      <th>19</th>
      <td>89</td>
      <td>183.95</td>
      <td>나이대3</td>
      <td>노년</td>
    </tr>
    <tr>
      <th>20</th>
      <td>82</td>
      <td>187.87</td>
      <td>나이대3</td>
      <td>노년</td>
    </tr>
    <tr>
      <th>21</th>
      <td>38</td>
      <td>164.30</td>
      <td>나이대2</td>
      <td>청년</td>
    </tr>
    <tr>
      <th>22</th>
      <td>26</td>
      <td>171.75</td>
      <td>나이대1</td>
      <td>청년</td>
    </tr>
    <tr>
      <th>23</th>
      <td>78</td>
      <td>165.37</td>
      <td>나이대3</td>
      <td>노년</td>
    </tr>
    <tr>
      <th>24</th>
      <td>73</td>
      <td>159.14</td>
      <td>나이대3</td>
      <td>노년</td>
    </tr>
    <tr>
      <th>25</th>
      <td>10</td>
      <td>176.40</td>
      <td>나이대1</td>
      <td>청소년</td>
    </tr>
    <tr>
      <th>26</th>
      <td>21</td>
      <td>166.14</td>
      <td>나이대1</td>
      <td>청년</td>
    </tr>
    <tr>
      <th>27</th>
      <td>81</td>
      <td>162.24</td>
      <td>나이대3</td>
      <td>노년</td>
    </tr>
    <tr>
      <th>28</th>
      <td>70</td>
      <td>179.96</td>
      <td>나이대3</td>
      <td>노년</td>
    </tr>
    <tr>
      <th>29</th>
      <td>80</td>
      <td>150.67</td>
      <td>나이대3</td>
      <td>노년</td>
    </tr>
  </tbody>
</table>
</div>




```python
l = [0,20,40,60,90]
나이대2 = pd.cut(df['나이'], bins=l, # 나눈는 기준점을 지정.
              labels=['청소년', '청년', '장년', '노년'])

나이대2
            
```




    0      장년
    1      장년
    2      노년
    3      노년
    4      노년
    5     청소년
    6      노년
    7      청년
    8      청년
    9      노년
    10     노년
    11     노년
    12     노년
    13    청소년
    14     장년
    15     노년
    16     청년
    17     노년
    18     장년
    19     노년
    20     노년
    21     청년
    22     청년
    23     노년
    24     노년
    25    청소년
    26     청년
    27     노년
    28     노년
    29     노년
    Name: 나이, dtype: category
    Categories (4, object): ['청소년' < '청년' < '장년' < '노년']




```python
df['나이대1']= 나이대2
df
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>나이</th>
      <th>키</th>
      <th>나이대1</th>
      <th>나이대</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>45</td>
      <td>168.18</td>
      <td>장년</td>
      <td>장년</td>
    </tr>
    <tr>
      <th>1</th>
      <td>48</td>
      <td>184.10</td>
      <td>장년</td>
      <td>장년</td>
    </tr>
    <tr>
      <th>2</th>
      <td>65</td>
      <td>166.26</td>
      <td>노년</td>
      <td>노년</td>
    </tr>
    <tr>
      <th>3</th>
      <td>68</td>
      <td>172.75</td>
      <td>노년</td>
      <td>노년</td>
    </tr>
    <tr>
      <th>4</th>
      <td>68</td>
      <td>160.39</td>
      <td>노년</td>
      <td>노년</td>
    </tr>
    <tr>
      <th>5</th>
      <td>10</td>
      <td>173.77</td>
      <td>청소년</td>
      <td>청소년</td>
    </tr>
    <tr>
      <th>6</th>
      <td>84</td>
      <td>170.33</td>
      <td>노년</td>
      <td>노년</td>
    </tr>
    <tr>
      <th>7</th>
      <td>22</td>
      <td>176.81</td>
      <td>청년</td>
      <td>청년</td>
    </tr>
    <tr>
      <th>8</th>
      <td>37</td>
      <td>154.37</td>
      <td>청년</td>
      <td>청년</td>
    </tr>
    <tr>
      <th>9</th>
      <td>88</td>
      <td>164.33</td>
      <td>노년</td>
      <td>노년</td>
    </tr>
    <tr>
      <th>10</th>
      <td>71</td>
      <td>167.58</td>
      <td>노년</td>
      <td>노년</td>
    </tr>
    <tr>
      <th>11</th>
      <td>89</td>
      <td>185.14</td>
      <td>노년</td>
      <td>노년</td>
    </tr>
    <tr>
      <th>12</th>
      <td>89</td>
      <td>166.67</td>
      <td>노년</td>
      <td>노년</td>
    </tr>
    <tr>
      <th>13</th>
      <td>13</td>
      <td>170.47</td>
      <td>청소년</td>
      <td>청소년</td>
    </tr>
    <tr>
      <th>14</th>
      <td>59</td>
      <td>184.63</td>
      <td>장년</td>
      <td>장년</td>
    </tr>
    <tr>
      <th>15</th>
      <td>66</td>
      <td>185.35</td>
      <td>노년</td>
      <td>노년</td>
    </tr>
    <tr>
      <th>16</th>
      <td>40</td>
      <td>175.66</td>
      <td>청년</td>
      <td>청년</td>
    </tr>
    <tr>
      <th>17</th>
      <td>88</td>
      <td>171.49</td>
      <td>노년</td>
      <td>노년</td>
    </tr>
    <tr>
      <th>18</th>
      <td>47</td>
      <td>159.22</td>
      <td>장년</td>
      <td>장년</td>
    </tr>
    <tr>
      <th>19</th>
      <td>89</td>
      <td>183.95</td>
      <td>노년</td>
      <td>노년</td>
    </tr>
    <tr>
      <th>20</th>
      <td>82</td>
      <td>187.87</td>
      <td>노년</td>
      <td>노년</td>
    </tr>
    <tr>
      <th>21</th>
      <td>38</td>
      <td>164.30</td>
      <td>청년</td>
      <td>청년</td>
    </tr>
    <tr>
      <th>22</th>
      <td>26</td>
      <td>171.75</td>
      <td>청년</td>
      <td>청년</td>
    </tr>
    <tr>
      <th>23</th>
      <td>78</td>
      <td>165.37</td>
      <td>노년</td>
      <td>노년</td>
    </tr>
    <tr>
      <th>24</th>
      <td>73</td>
      <td>159.14</td>
      <td>노년</td>
      <td>노년</td>
    </tr>
    <tr>
      <th>25</th>
      <td>10</td>
      <td>176.40</td>
      <td>청소년</td>
      <td>청소년</td>
    </tr>
    <tr>
      <th>26</th>
      <td>21</td>
      <td>166.14</td>
      <td>청년</td>
      <td>청년</td>
    </tr>
    <tr>
      <th>27</th>
      <td>81</td>
      <td>162.24</td>
      <td>노년</td>
      <td>노년</td>
    </tr>
    <tr>
      <th>28</th>
      <td>70</td>
      <td>179.96</td>
      <td>노년</td>
      <td>노년</td>
    </tr>
    <tr>
      <th>29</th>
      <td>80</td>
      <td>150.67</td>
      <td>노년</td>
      <td>노년</td>
    </tr>
  </tbody>
</table>
</div>




```python
df['나이대1'].value_counts()
df['나이대1'].value_counts(normalize=True)
```




    노년     0.566667
    청년     0.200000
    장년     0.133333
    청소년    0.100000
    Name: 나이대1, dtype: float64




```python
df['키'].mean()
```




    170.843




```python
df.groupby('나이대1')['키'].mean()
```




    나이대1
    청소년    173.546667
    청년     168.171667
    장년     174.032500
    노년     170.558235
    Name: 키, dtype: float64



- qcut : 동일한 원소수(개수)로 나눈다.


```python
키대 = pd.qcut(df['키'], # 나눌 대상
        q = 3,  # 몇 개로 나눌지
        labels = ['작으키','중간키','큰키']
            )
키대
```




    0     중간키
    1      큰키
    2     중간키
    3     중간키
    4     작으키
    5     중간키
    6     중간키
    7      큰키
    8     작으키
    9     작으키
    10    중간키
    11     큰키
    12    중간키
    13    중간키
    14     큰키
    15     큰키
    16     큰키
    17    중간키
    18    작으키
    19     큰키
    20     큰키
    21    작으키
    22    중간키
    23    작으키
    24    작으키
    25     큰키
    26    작으키
    27    작으키
    28     큰키
    29    작으키
    Name: 키, dtype: category
    Categories (3, object): ['작으키' < '중간키' < '큰키']




```python
키대.value_counts()
```




    작으키    10
    중간키    10
    큰키     10
    Name: 키, dtype: int64




```python
df['키대'] = 키대
```


```python
df.groupby('키대')['나이'].mean()
```




    키대
    작으키    61.1
    중간키    55.9
    큰키     57.5
    Name: 나이, dtype: float64



# <b style='font-size:2em'>TODO </b>


```python
import os
os.getcwd()
```




    '/Users/seokminlee/Desktop/mose/pandas_template'



## 1: data/diamonds.csv 를 읽어 DataFrame으로 만든다.


```python
dia = pd.read_csv('data/diamonds.csv')
dia.shape
```




    (53940, 10)



## 2: price 컬럼을 '고가', '중가', '저가' 세개의 범주값을 가지는 "price_cate" 컬럼을 생성한다.


```python
labels=['고가', '중가', '저가']
price_cate = pd.cut(dia['price'], 3,     
             labels=labels) 
price_cate
```




    0        고가
    1        고가
    2        고가
    3        고가
    4        고가
             ..
    53935    고가
    53936    고가
    53937    고가
    53938    고가
    53939    고가
    Name: price, Length: 53940, dtype: category
    Categories (3, object): ['고가' < '중가' < '저가']




```python
pd.cut(dia['price'], [300,1000,10000,20000], # 원하는 범위로 나눌떄
      labels =labels
      ) 
dia['price_cate'] = price_cate
```


```python
pd.qcut(dia['price'], 3, labels = labels) # 데이터수로 등분
```


```python
dia.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>carat</th>
      <th>cut</th>
      <th>color</th>
      <th>clarity</th>
      <th>depth</th>
      <th>table</th>
      <th>price</th>
      <th>x</th>
      <th>y</th>
      <th>z</th>
      <th>price_cate</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.23</td>
      <td>Ideal</td>
      <td>E</td>
      <td>SI2</td>
      <td>61.5</td>
      <td>55.0</td>
      <td>326</td>
      <td>3.95</td>
      <td>3.98</td>
      <td>2.43</td>
      <td>고가</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.21</td>
      <td>Premium</td>
      <td>E</td>
      <td>SI1</td>
      <td>59.8</td>
      <td>61.0</td>
      <td>326</td>
      <td>3.89</td>
      <td>3.84</td>
      <td>2.31</td>
      <td>고가</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.23</td>
      <td>Good</td>
      <td>E</td>
      <td>VS1</td>
      <td>56.9</td>
      <td>65.0</td>
      <td>327</td>
      <td>4.05</td>
      <td>4.07</td>
      <td>2.31</td>
      <td>고가</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.29</td>
      <td>Premium</td>
      <td>I</td>
      <td>VS2</td>
      <td>62.4</td>
      <td>58.0</td>
      <td>334</td>
      <td>4.20</td>
      <td>4.23</td>
      <td>2.63</td>
      <td>고가</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.31</td>
      <td>Good</td>
      <td>J</td>
      <td>SI2</td>
      <td>63.3</td>
      <td>58.0</td>
      <td>335</td>
      <td>4.34</td>
      <td>4.35</td>
      <td>2.75</td>
      <td>고가</td>
    </tr>
  </tbody>
</table>
</div>



## 3 가격대(price_cate) 별 carat의 평균을 조회


```python
dia.groupby('price_cate')['carat'].mean()
```




    price_cate
    고가    0.627943
    중가    1.362280
    저가    1.885256
    Name: carat, dtype: float64



## 4 가격대(price_cate)와 cut별 평균 가격(price)를 피봇테이블로 조회


```python
dia.pivot_table(index = 'cut', columns = 'price_cate', values = 'price', aggfunc = 'mean')
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>price_cate</th>
      <th>고가</th>
      <th>중가</th>
      <th>저가</th>
    </tr>
    <tr>
      <th>cut</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Fair</th>
      <td>2976.492819</td>
      <td>8891.044335</td>
      <td>15176.404762</td>
    </tr>
    <tr>
      <th>Good</th>
      <td>2589.423161</td>
      <td>8744.889273</td>
      <td>15412.570213</td>
    </tr>
    <tr>
      <th>Ideal</th>
      <td>1991.838539</td>
      <td>9019.390308</td>
      <td>15422.528676</td>
    </tr>
    <tr>
      <th>Premium</th>
      <td>2513.585759</td>
      <td>9045.209888</td>
      <td>15391.247016</td>
    </tr>
    <tr>
      <th>Very Good</th>
      <td>2383.723178</td>
      <td>8921.683740</td>
      <td>15502.217323</td>
    </tr>
  </tbody>
</table>
</div>



## 5 cut, color, price_cate 별 carat의 평균을 피봇테이블로 조회


```python
dia.pivot_table(index = ['price_cate', 'cut'], columns = 'color', values = 'carat', aggfunc = 'mean')
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>color</th>
      <th>D</th>
      <th>E</th>
      <th>F</th>
      <th>G</th>
      <th>H</th>
      <th>I</th>
      <th>J</th>
    </tr>
    <tr>
      <th>price_cate</th>
      <th>cut</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">고가</th>
      <th>Fair</th>
      <td>0.807122</td>
      <td>0.767424</td>
      <td>0.791801</td>
      <td>0.849462</td>
      <td>0.977699</td>
      <td>0.988750</td>
      <td>1.067717</td>
    </tr>
    <tr>
      <th>Good</th>
      <td>0.670725</td>
      <td>0.651305</td>
      <td>0.689913</td>
      <td>0.708228</td>
      <td>0.730387</td>
      <td>0.764122</td>
      <td>0.854693</td>
    </tr>
    <tr>
      <th>Ideal</th>
      <td>0.502135</td>
      <td>0.511158</td>
      <td>0.529869</td>
      <td>0.528951</td>
      <td>0.617462</td>
      <td>0.669981</td>
      <td>0.792335</td>
    </tr>
    <tr>
      <th>Premium</th>
      <td>0.599525</td>
      <td>0.591792</td>
      <td>0.666792</td>
      <td>0.629871</td>
      <td>0.765683</td>
      <td>0.794620</td>
      <td>0.901903</td>
    </tr>
    <tr>
      <th>Very Good</th>
      <td>0.599320</td>
      <td>0.577348</td>
      <td>0.619161</td>
      <td>0.614364</td>
      <td>0.712640</td>
      <td>0.760677</td>
      <td>0.832754</td>
    </tr>
    <tr>
      <th rowspan="5" valign="top">중가</th>
      <th>Fair</th>
      <td>1.339412</td>
      <td>1.443500</td>
      <td>1.564483</td>
      <td>1.807895</td>
      <td>1.796226</td>
      <td>1.784000</td>
      <td>1.985000</td>
    </tr>
    <tr>
      <th>Good</th>
      <td>1.277551</td>
      <td>1.256889</td>
      <td>1.298312</td>
      <td>1.349915</td>
      <td>1.523187</td>
      <td>1.630000</td>
      <td>1.695397</td>
    </tr>
    <tr>
      <th>Ideal</th>
      <td>1.170843</td>
      <td>1.198333</td>
      <td>1.189853</td>
      <td>1.193722</td>
      <td>1.398540</td>
      <td>1.533642</td>
      <td>1.645655</td>
    </tr>
    <tr>
      <th>Premium</th>
      <td>1.264649</td>
      <td>1.260486</td>
      <td>1.268342</td>
      <td>1.300076</td>
      <td>1.525855</td>
      <td>1.610519</td>
      <td>1.716263</td>
    </tr>
    <tr>
      <th>Very Good</th>
      <td>1.226980</td>
      <td>1.212459</td>
      <td>1.193546</td>
      <td>1.244620</td>
      <td>1.489892</td>
      <td>1.551324</td>
      <td>1.707778</td>
    </tr>
    <tr>
      <th rowspan="5" valign="top">저가</th>
      <th>Fair</th>
      <td>2.145714</td>
      <td>1.843333</td>
      <td>1.957273</td>
      <td>1.995000</td>
      <td>2.218750</td>
      <td>2.407778</td>
      <td>2.691818</td>
    </tr>
    <tr>
      <th>Good</th>
      <td>1.626500</td>
      <td>1.717097</td>
      <td>1.809286</td>
      <td>1.864048</td>
      <td>2.093810</td>
      <td>2.104643</td>
      <td>2.242500</td>
    </tr>
    <tr>
      <th>Ideal</th>
      <td>1.430909</td>
      <td>1.501395</td>
      <td>1.609551</td>
      <td>1.694875</td>
      <td>1.947143</td>
      <td>2.097365</td>
      <td>2.229880</td>
    </tr>
    <tr>
      <th>Premium</th>
      <td>1.636000</td>
      <td>1.715130</td>
      <td>1.705594</td>
      <td>1.793261</td>
      <td>2.069171</td>
      <td>2.127762</td>
      <td>2.236724</td>
    </tr>
    <tr>
      <th>Very Good</th>
      <td>1.552857</td>
      <td>1.740141</td>
      <td>1.688632</td>
      <td>1.735664</td>
      <td>2.019664</td>
      <td>2.100703</td>
      <td>2.150377</td>
    </tr>
  </tbody>
</table>
</div>



# 4강 명령어 메모 .


```python
f2.sample(frac=0.3) # 비율 (전체중 30%의 행만 추출)

컬럼(열) 삽입 - df.insert(삽입할 컬럼 순번, 컬럼이름, 값들)
df.insert(1, "cnt1평균", result['cnt1'])

['CANCELLED'].sum() # 취소된 개수
```
